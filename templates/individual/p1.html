<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>

    <title>ê¸ì • ì€ì •</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@200;300;400;500;600;700;900&display=swap" rel="stylesheet">

    <style>
        * {
            margin: 0;
            padding: 0;
        }

        .chat_wrap {
            width: 40%;
            height: 100%;
            margin: 0 auto;
            font-size: 13px;
        }

        .chat_wrap .header {
            font-size: 16px;
            padding: 12px 0;
            background: #2D663C;
            color: white;
            text-align: center;
        }

        .chat_wrap .introduceEJ ul {
            padding: 0px;
        }

        .chat_wrap EJ {
            text-align: left;
        }

        .chat_wrap .VS {
            text-align: right;
        }

        .chat_wrap .chat ul li.right {
            text-align: right;
        }

        .chat_wrap .chat {
            padding-bottom: 80px;
        }

        .chat_wrap .chat ul {
            width: 100%;
            list-style: none;
        }

        .chat_wrap .chat ul li {
            width: 100%;
        }

        .chat_wrap .chat ul li div.sender {
            margin: 6px 10px 0 10px;
            font-weight: bold;
            color: #0C2D12;
        }

        .messageL {
            display: inline-block;
            word-break: break-all;
            margin: 4px 10px;
            max-width: 60%;
            border: 1px solid #0c2d12;
            padding: 10px;
            border-radius: 5px;
            background-color: #F2F4F2;
            color: #0c2d12;
            text-align: left;
        }

        .messageR {
            display: inline-block;
            word-break: break-all;
            margin: 4px 10px;
            max-width: 60%;
            border: 1px solid #0C2D12;
            padding: 10px;
            border-radius: 5px;
            background-color: #7fad7f;
            color: #FFF;
            text-align: left;
        }

        .messageDB {
            display: inline-block;
            word-break: break-all;
            margin: 4px 10px;
            max-width: 60%;
            border: 1px solid #0C2D12;
            padding: 10px;
            border-radius: 5px;
            background-color: #2D663C;
            color: #FFF;
            text-align: left;
        }

        .chat_wrap .input-div {
            position: fixed;
            bottom: 0;
            width: 40%;
            background-color: #FFFFFF;
            text-align: center;
            border: 1px solid darkgreen;
            margin: 0 auto;
        }

        .chat_wrap .input-div > textarea {
            width: 100%;
            height: 80px;
            border: none;
            padding: 10px;
        }

        .chat_wrap .introduceEJ .EJ-chat2 {
            display: none;
        }

        .chat_wrap .introduceEJ .EJ-chat3 {
            display: none;
        }

        .chat_wrap .introduceEJ .EJ-chat4 {
            display: none;
        }

        .chat_wrap .introduceEJ .VS-chat1 {
            display: none;
        }

        .chat_wrap .introduceEJ .VS-chat2 {
            display: none;
        }

        .chat_wrap .introduceEJ .VS-chat3 {
            display: none;
        }

        .format {
            display: none;
        }

    </style>

    <script>
        $(document).ready(function () {
            show_chat();
        });

        function show_chat() {
            //$('#dbVisit').empty()
            $.ajax({
                type: 'GET',
                url: '/p1_chat',
                data: {},
                success: function (response) {
                    let rows = response['visitChat']

                    for (let i = 0; i < rows.length; i++) {
                        let chatMsg = rows[i]['visitChat']

                        let temp_html = `<li>
                                            <div class="VS">
                                                <div>
                                                    <div class="sender">visitor</div>
                                                    <div class="messageDB">${chatMsg}</div>
                                                </div>
                                            </div>
                                         </li>`
                        $('#dbVisit').append(temp_html)
                    }
                    console.log(rows);
                }
            });
        }

        const Chat = (function () {
            //const myName = "sparta";

            // init í•¨ìˆ˜
            function init() {
                // enter í‚¤ ì´ë²¤íŠ¸
                $(document).on('keydown', 'div.input-div textarea', function (e) {
                    if (e.keyCode == 13 && !e.shiftKey) {
                        e.preventDefault();
                        const messageDB = $(this).val();

                        // ë©”ì‹œì§€ ì „ì†¡
                        sendMessage(messageDB);
                        // ì…ë ¥ì°½ clear
                        clearTextarea();
                    }
                });
            }


            // ë©”ì„¸ì§€ íƒœê·¸ ìƒì„±
            function createMessageTag(LR_className, senderName, messageDB) {
                // í˜•ì‹ ê°€ì ¸ì˜¤ê¸°
                let chatLi = $('div.chat.format ul li').clone();

                // ê°’ ì±„ìš°ê¸°
                chatLi.addClass(LR_className);
                chatLi.find('.sender span').text(senderName);
                chatLi.find('.messageDB span').text(messageDB);

                return chatLi;
            }

            // ë©”ì„¸ì§€ íƒœê·¸ append
            function appendMessageTag(LR_className, senderName, messageDB) {
                const chatLi = createMessageTag(LR_className, senderName, messageDB);

                $('div.chatDB ul').append(chatLi);
                //$('div.chat:not(.introduceEJ .format) ul').append(chatLi);

                // ìŠ¤í¬ë¡¤ë°” ì•„ë˜ ê³ ì •
                //$('div.chat').scrollTop($('div.chat').prop('scrollHeight'));
            }

            // ë©”ì„¸ì§€ ì „ì†¡
            function sendMessage(messageDB) {
                $.ajax({
                    type: "POST",
                    url: "/p1_chat",
                    data: {visitChat_give: messageDB},

                    success: function (response) {
                        alert(response["msg"])
                        //window.location.reload()
                    }
                });

              // ì„œë²„ì— ì „ì†¡í•˜ëŠ” ì½”ë“œë¡œ í›„ì— ëŒ€ì²´
                const data = {
                    "senderName": "visitor",
                    "messageDB": messageDB
                    //ì—¬ê¸°ì— í˜„ì¬ ì‹œê°„ ë„£ìœ¼ë©´ ë  ë“¯
                };

                // í†µì‹ í•˜ëŠ” ê¸°ëŠ¥ì´ ì—†ìœ¼ë¯€ë¡œ ì—¬ê¸°ì„œ receive
                resive(data);
            }

            // ë©”ì„¸ì§€ ì…ë ¥ë°•ìŠ¤ ë‚´ìš© ì§€ìš°ê¸°
            function clearTextarea() {
                $('div.input-div textarea').val('');
            }

            // ë©”ì„¸ì§€ ìˆ˜ì‹ 
            function resive(data) {
                //const LR = (data.senderName != myName) ? "left" : "right";


                appendMessageTag("right", data.senderName, data.messageDB);
            }

            return {
                'init': init
            };
        })();

        $(function () {
            Chat.init();
        });


        function open_box1() {
            $('#v-chat1').show()
        }

        function open_box2() {
            $('#ej-chat2').show()
        }

        function open_box3() {
            $('#v-chat2').show()
        }

        function open_box4() {
            $('#ej-chat3').show()
        }

        function open_box5() {
            $('#v-chat3').show()
        }

        function open_box6() {
            $('#ej-chat4').show()
        }


    </script>
</head>
<body>
<div class="chat_wrap">
    <div class="header">
        ê¹€ì€ì •
    </div>

    <div class="chat introduceEJ">
        <ul>
            <li>
                <div class="EJ">
                    <div class="EJ-chat1">
                        <div class="sender">ê¹€ì€ì •</div>
                        <button class="messageL" onclick="open_box1()">ì•ˆë…•í•˜ì„¸ìš”!! &#128075;</button>
                    </div>
                </div>
            </li>
            <li>
                <div class="VS">
                    <div class="VS-chat1" id="v-chat1">
                        <div class="sender">sparta</div>
                        <button class="messageR" onclick="open_box2()">ëˆ„êµ¬ì„¸ìš”?</button>
                    </div>
                </div>
            </li>
            <li>
                <div class="EJ">
                    <div class="EJ-chat2" id="ej-chat2">

                        <div class="sender">ê¹€ì€ì •</div>
                        <ul class="leftChat">
                            <li>
                                <div class="messageL">ì €ëŠ” ê¸ì • ì€ì •ì…ë‹ˆë‹¤~!!</div>
                            </li>
                            <li>
                                <div class="messageL">ê¸ì •ì´ë€ ë§ì„ ì¢‹ì•„í•˜ê¸°ë„ í•˜ì§€ë§Œ!</div>
                            </li>
                            <li>
                                <div class="messageL">ì‚¬ì‹¤ ì´ë¦„ì˜ 'ì€'ì„ 180ë„ ëŒë¦¬ë©´ 'ê¸'ì´ ë˜ì–´ì„œ ê¸ì •ì´ë€ ë‹‰ë„¤ì„ì„ ì“°ê³  ìˆì–´ìš”!</div>
                            </li>
                            <li>
                                <button class="messageL" onclick="open_box3()">ë§ˆì¹¨ ì œ MBTIë„..! E.N.F.P ì—”í”„í”¼ëë‹ˆë‹¤~!! ğŸ˜Š</button>
                            </li>
                        </ul>
                    </div>
                </div>
            </li>

            <li>
                <div class="VS">
                    <div class="VS-chat2" id="v-chat2">
                        <div class="sender">sparta</div>
                        <ul class="rightChat">
                            <li>
                                <div class="messageR">ì˜¤ì˜¤!!</div>
                            </li>
                            <li>
                                <div class="messageR">ì¡°ê¸ˆ ë” ì†Œê°œí•´ì£¼ì„¸ìš”!!</div>
                            </li>
                            <li>
                                <button class="messageR" onclick="open_box4()">ë³¸ì¸ ì¥ì ì´ë¼ë˜ê°€... ì¥ì ì´ë¼ë˜ê°€... ì¥ì ì´ë¼ë˜ê°€..ã…‹ã…‹ã…‹ã…‹ã…‹ã…‹</button>
                            </li>

                        </ul>
                    </div>
                </div>
            </li>
            <li>
                <div class="EJ">
                    <div class="EJ-chat3" id="ej-chat3">
                        <div class="sender">ê¹€ì€ì •</div>
                        <ul class="leftChat">
                            <li>
                                <div class="messageL">ã…‹ã…‹ã…‹ã…‹ã…‹</div>
                            </li>
                            <li>
                                <div class="messageL">ì œ ì¥ì ì€ ë‹‰ë„¤ì„ì²˜ëŸ¼ ê¸ì •ì ì¸ ì„±ê²©ê³¼</div>
                            </li>
                            <li>
                                <div class="messageL">ì˜¤ëŠ˜ ì²˜ìŒ ë³¸ ì‚¬ëŒê³¼ë„ ì ˆì¹œ(?)ì´ ë  ìˆ˜ ìˆëŠ” ì¹œí™”ë ¥ì´ë¼ê³  ìƒê°í•©ë‹ˆë‹¤!!</div>
                            </li>
                            <li>
                                <button class="messageL" onclick="open_box5()">ë‹¤ë§Œ ì´ ì¹œí™”ë ¥ì€ í•œë²ˆ ë°œë™í•˜ë©´ ì—ë„ˆì§€ì†Œëª¨ê°€ ë„ˆë¬´ ì»¤ì„œã…‹ã…‹...  ìš”ì¦˜ì—” ìƒí™©ì„ ë´ ê°€ë©´ì„œ ì“°ê³  ìˆì–´ìš”ã…ã… ğŸ˜…</button>
                            </li>
                        </ul>
                    </div>
                </div>
            </li>
            <li>
                <div class="VS">
                    <div class="VS-chat3" id="v-chat3">
                        <div class="sender">sparta</div>
                        <ul class="rightChat">
                            <li>
                                <div class="messageR">ì•„ ë¬´ìŠ¨ ë§ì¸ì§€ ì•Œ ê²ƒ ê°™ì•„ìš”ã…‹ã…‹ã…‹</div>
                            </li>
                            <li>
                                <button class="messageR" onclick="open_box6()">ê·¸ëŸ¼ ì€ì •ë‹˜ì€ í˜‘ì—…í•˜ëŠ” ê³¼ì •ì—ì„œëŠ” ì–´ë–¤ ìŠ¤íƒ€ì¼ì´ì„¸ìš”?</button>
                            </li>
                        </ul>
                    </div>
                </div>
            </li>
            <li>
                <div class="EJ">
                    <div class="EJ-chat4" id="ej-chat4">
                        <div class="sender">ê¹€ì€ì •</div>
                        <ul class="leftChat">
                            <li>
                                <div class="messageL">ì €ëŠ” ì£¼ë¡œ ì‚¬ëŒë“¤ ì‚¬ì´ì—ì„œ ì˜ê²¬ì„ ë“¤ì–´ë³´ê³  ì¡°ìœ¨ì„ í•˜ê±°ë‚˜</div>
                            </li>
                            <li>
                                <div class="messageL">ëª¨ì„ì˜ ë¶„ìœ„ê¸°ë¥¼ í•˜ë‚˜ë¡œ ëª¨ìœ¼ë ¤ê³  ë…¸ë ¥ì„ ë§ì´ í•˜ëŠ” í¸ì¸ê²ƒ ê°™ì•„ìš”</div>
                            </li>
                            <li>
                                <div class="messageL">(ì‚¬ì‹¤ ì œê°€ ì–´ìƒ‰í•œ ë¶„ìœ„ê¸°ë¥¼ ì •ë§ ëª»ê²¬ë”¥ë‹ˆë‹¤ ã…ã…ã…ã…)</div>
                            </li>
                            <li>
                                <div class="messageL">ì €ì—ê²Œ ì£¼ì–´ì§„ ê³¼ì œëŠ” ì¼ë‹¨ì€ ì € ìŠ¤ìŠ¤ë¡œ í•´ê²°í•˜ë ¤ê³  ë…¸ë ¥ì€ í•˜ëŠ” í¸ì¸ë°</div>
                            </li>
                            <li>
                                <div class="messageL">ë§˜ì²˜ëŸ¼ ì‰½ì§€ê°€ ì•Šë„¤ìš”,,ã…ã… ğŸ˜‚</div>
                            </li>
                            <li>
                                <div class="messageL">í•˜ì§€ë§Œ! ì—´ì‹¬íˆ í•´ë³´ë„ë¡ ë…¸ë ¥í•˜ê² ìŠµë‹ˆë‹¤!! ì•„ìì•„ì!! &#128074; </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </li>
        </ul>
    </div>

    <div class="chat chatVS">
        <div class="chatDB">
            <ul id="dbVisit">
                <!-- ë™ì  ìƒì„± -->
            </ul>
        </div>
    </div>

    <div class="input-div">
        <textarea placeholder="ë°©ëª…ë¡ ì‘ì„± í›„ ì—”í„°!"></textarea>
    </div>

    <!-- format -->
    <div class="chat format">
        <ul id="vsList">
            <li>
                <div class="sender">
                    <span></span>
                </div>
                <div class="messageDB">
                    <span></span>
                </div>
            </li>
        </ul>
    </div>
</div>

</body>
</html>